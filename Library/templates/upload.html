{% extends "style.html" %}
{% block title %} <b>Uploads</b> {% endblock %}
{% block content %}
<h2>Upload World</h2>

<!-- this form will submit teh book to the library, the one which they had requested to be added by calling the bookMake function -->
<form class="comic" onsubmit="bookMake(event)">
  <!-- here we have our inputs and requirements that the user needs to fill in so that they can add a book to the library-->
  <p>Book name: </p>
  <input type="text" id="name" required>
  <p>Book Author: </p>
  <input type="text" id="author" required>
  <p>Book year: </p>
  <input type="number" id="year" required>
  <p>Book Serial Number: </p>
  <input type="number" id="serial" required>
  <button type="submit"> Add Book</button>
</form>

<script>
  /* this will store all the books that we have within our library */
  const cart = {{ cart | safe }};

  /* This will check and make sure that there are no exact duplicates within the library*/
  function bookMake(event){
    event.preventDefault();

    var dupli = false;
    var title = document.getElementById("name").value.toLowerCase();
    var writer = document.getElementById("author").value.toLowerCase();
    var time = document.getElementById("year").value;
    var num = document.getElementById("serial").value;

    for (let book of cart){
      if(book.title == title && book.author == writer && book.year == time && book.serial == num){
        dupli = true;
        break;
      }
    }

  /* If the input is not considered a duplicate, then we will send the book info to the backend to have it added to
  the library database */
    if(!dupli){
      fetch("http://127.0.0.1:5000/addBook", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          name: title,
          writer: writer,
          year: time,
          serial: num,
        })
      })
      .then(response => response.json())
      .then(data => {
      /* We will alert the user that the book has been added to teh database if it was truly successful*/
        alert(data.name + " by " + data.Writer + " has been added to our library");
      })
      .catch(error => alert("Error: " + error)); // fixed error display too
    } else {
    /* If a duplicate is found, then we will let the user know that it is already within the database*/
      alert("We already have the book within our library");
    }
  }
</script>


{% endblock %}